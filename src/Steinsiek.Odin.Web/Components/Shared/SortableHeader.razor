<th style="cursor: pointer; user-select: none;" @onclick="HandleClick">
    <span class="d-inline-flex align-items-center gap-1">
        @Title
        @if (string.Equals(CurrentSort, SortKey, StringComparison.OrdinalIgnoreCase))
        {
            @if (CurrentSortDir == SortDirection.Asc)
            {
                <i class="bi bi-sort-up"></i>
            }
            else
            {
                <i class="bi bi-sort-down"></i>
            }
        }
        else
        {
            <i class="bi bi-arrow-down-up text-muted" style="opacity: 0.3;"></i>
        }
    </span>
</th>

@code {
    /// <summary>
    /// The column header display text.
    /// </summary>
    [Parameter]
    public string Title { get; set; } = string.Empty;

    /// <summary>
    /// The sort key identifier for this column.
    /// </summary>
    [Parameter]
    public string SortKey { get; set; } = string.Empty;

    /// <summary>
    /// The currently active sort column.
    /// </summary>
    [Parameter]
    public string? CurrentSort { get; set; }

    /// <summary>
    /// The current sort direction.
    /// </summary>
    [Parameter]
    public SortDirection? CurrentSortDir { get; set; }

    /// <summary>
    /// Callback invoked when the sort state changes, passing the sort key and direction.
    /// </summary>
    [Parameter]
    public EventCallback<(string SortKey, SortDirection? SortDir)> OnSort { get; set; }

    /// <summary>
    /// Cycles through sort states: ascending, descending, then no sort.
    /// </summary>
    private async Task HandleClick()
    {
        if (!string.Equals(CurrentSort, SortKey, StringComparison.OrdinalIgnoreCase))
        {
            await OnSort.InvokeAsync((SortKey, SortDirection.Asc));
        }
        else if (CurrentSortDir == SortDirection.Asc)
        {
            await OnSort.InvokeAsync((SortKey, SortDirection.Desc));
        }
        else
        {
            await OnSort.InvokeAsync((SortKey, (SortDirection?)null));
        }
    }
}
