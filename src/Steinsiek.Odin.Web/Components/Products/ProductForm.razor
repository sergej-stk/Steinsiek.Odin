@inject ICategoryApiClient CategoryApi

<EditForm Model="_data" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />
    <div class="row g-3">
        <div class="col-12">
            <label class="form-label">Name</label>
            <InputText @bind-Value="_data.Name" class="form-control" maxlength="100" />
            <ValidationMessage For="@(() => _data.Name)" />
        </div>
        <div class="col-12">
            <label class="form-label">Description</label>
            <InputTextArea @bind-Value="_data.Description" class="form-control" rows="3" />
        </div>
        <div class="col-12 col-sm-6">
            <label class="form-label">Price</label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <InputNumber @bind-Value="_data.Price" class="form-control" />
            </div>
            <ValidationMessage For="@(() => _data.Price)" />
        </div>
        <div class="col-12 col-sm-6">
            <label class="form-label">Stock</label>
            <InputNumber @bind-Value="_data.Stock" class="form-control" />
            <ValidationMessage For="@(() => _data.Stock)" />
        </div>
        <div class="col-12">
            <label class="form-label">Image URL</label>
            <InputText @bind-Value="_data.ImageUrl" class="form-control" placeholder="https://..." />
        </div>
        <div class="col-12">
            <label class="form-label">Category</label>
            @if (_categories is not null)
            {
                <InputSelect @bind-Value="_data.CategoryId" class="form-select">
                    <option value="">Select a category...</option>
                    @foreach (var category in _categories.Data)
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => _data.CategoryId)" />
            }
            else
            {
                <div class="placeholder-glow">
                    <span class="placeholder col-12" style="height: 38px;"></span>
                </div>
            }
        </div>
        @if (ShowIsActive)
        {
            <div class="col-12">
                <div class="form-check form-switch">
                    <InputCheckbox @bind-Value="_data.IsActive" class="form-check-input" id="productActiveSwitch" />
                    <label class="form-check-label" for="productActiveSwitch">Active</label>
                </div>
            </div>
        }
        <div class="col-12 d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" @onclick="OnCancel">Cancel</button>
            <button type="submit" class="btn btn-primary" disabled="@IsSubmitting">
                @if (IsSubmitting)
                {
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                }
                @SubmitText
            </button>
        </div>
    </div>
</EditForm>

@code {
    private ListResult<CategoryDto>? _categories;
    private ProductFormData _data = new();

    /// <summary>
    /// Initial form data to populate the form with.
    /// </summary>
    [Parameter]
    public ProductFormData? InitialData { get; set; }

    /// <summary>
    /// Whether to show the IsActive toggle.
    /// </summary>
    [Parameter]
    public bool ShowIsActive { get; set; }

    /// <summary>
    /// The submit button text.
    /// </summary>
    [Parameter]
    public string SubmitText { get; set; } = "Create";

    /// <summary>
    /// Whether the form is currently submitting.
    /// </summary>
    [Parameter]
    public bool IsSubmitting { get; set; }

    /// <summary>
    /// Callback when the form is submitted with the form data.
    /// </summary>
    [Parameter]
    public EventCallback<ProductFormData> OnSubmit { get; set; }

    /// <summary>
    /// Callback when the form is cancelled.
    /// </summary>
    [Parameter]
    public EventCallback OnCancel { get; set; }

    /// <inheritdoc />
    protected override async Task OnInitializedAsync()
    {
        if (InitialData is not null)
        {
            _data = InitialData;
        }

        _categories = await CategoryApi.GetAll(CancellationToken.None);
    }

    private async Task HandleSubmit()
    {
        await OnSubmit.InvokeAsync(_data);
    }
}
