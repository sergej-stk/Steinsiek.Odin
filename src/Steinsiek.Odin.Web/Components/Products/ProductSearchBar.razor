@implements IDisposable

<div class="input-group">
    <span class="input-group-text"><i class="bi bi-search"></i></span>
    <input type="text" class="form-control" placeholder="Search products..."
           value="@Value" @oninput="OnInput" />
</div>

@code {
    private Timer? _debounceTimer;

    /// <summary>
    /// The current search value.
    /// </summary>
    [Parameter]
    public string? Value { get; set; }

    /// <summary>
    /// Callback when the search value changes (debounced).
    /// </summary>
    [Parameter]
    public EventCallback<string?> ValueChanged { get; set; }

    private void OnInput(ChangeEventArgs e)
    {
        var newValue = e.Value?.ToString();
        _debounceTimer?.Dispose();
        _debounceTimer = new Timer(async _ =>
        {
            await InvokeAsync(async () =>
            {
                Value = newValue;
                await ValueChanged.InvokeAsync(newValue);
            });
        }, null, 300, Timeout.Infinite);
    }

    /// <inheritdoc />
    public void Dispose()
    {
        _debounceTimer?.Dispose();
    }
}
