@page "/products/create"
@attribute [Authorize]
@inject IProductApiClient ProductApi
@inject NavigationManager Navigation
@inject IToastService ToastService

<PageTitle>Create Product - Odin</PageTitle>

<PageHeader Title="Create Product">
    <Actions>
        <a href="/products" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Back
        </a>
    </Actions>
</PageHeader>

<div class="card" style="max-width: 800px;">
    <div class="card-body p-4">
        <ProductForm SubmitText="Create Product"
                     IsSubmitting="@_isSubmitting"
                     OnSubmit="@HandleCreate"
                     OnCancel="@(() => Navigation.NavigateTo("/products"))" />
    </div>
</div>

@code {
    private bool _isSubmitting;

    private async Task HandleCreate(ProductFormData data)
    {
        _isSubmitting = true;

        var request = new CreateProductRequest
        {
            Name = data.Name,
            Description = data.Description,
            Price = data.Price,
            Stock = data.Stock,
            ImageUrl = data.ImageUrl,
            CategoryId = data.CategoryId
        };

        var result = await ProductApi.Create(request, CancellationToken.None);

        if (result is not null)
        {
            ToastService.Show("Product created successfully", ToastLevel.Success);
            Navigation.NavigateTo($"/products/{result.Id}");
        }
        else
        {
            ToastService.Show("Failed to create product", ToastLevel.Error);
        }

        _isSubmitting = false;
    }
}
