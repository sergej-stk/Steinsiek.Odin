@page "/profile"
@attribute [Authorize]
@inject IAuthApiClient AuthApi

<PageTitle>Profile - Odin</PageTitle>

<PageHeader Title="Profile" Subtitle="Your account information" />

@if (_user is null && !_error)
{
    <MudProgressLinear Indeterminate="true" Color="Color.Primary" />
}
else if (_error)
{
    <MudAlert Severity="Severity.Error" Class="mb-4">
        Failed to load profile information. Please try again later.
    </MudAlert>
}
else if (_user is not null)
{
    <MudGrid>
        <MudItem xs="12" md="6">
            <MudCard Elevation="2" Class="rounded-lg">
                <MudCardContent>
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-4">
                        <MudAvatar Size="Size.Large" Color="Color.Primary" Style="width: 80px; height: 80px; font-size: 2rem;">
                            @(_user.FirstName[0])@(_user.LastName[0])
                        </MudAvatar>
                        <MudText Typo="Typo.h5" Style="font-weight: 700;">
                            @_user.FirstName @_user.LastName
                        </MudText>
                        <MudText Typo="Typo.body1" Color="Color.Secondary">
                            @_user.Email
                        </MudText>
                    </MudStack>
                    <MudDivider Class="my-4" />
                    <MudList T="string" Dense="true">
                        <MudListItem T="string" Icon="@Icons.Material.Filled.Badge">
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">User ID</MudText>
                                <MudText Typo="Typo.body2" Style="font-family: monospace;">@_user.Id</MudText>
                            </MudStack>
                        </MudListItem>
                        <MudListItem T="string" Icon="@Icons.Material.Filled.Person">
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">First Name</MudText>
                                <MudText Typo="Typo.body2">@_user.FirstName</MudText>
                            </MudStack>
                        </MudListItem>
                        <MudListItem T="string" Icon="@Icons.Material.Filled.Person">
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Last Name</MudText>
                                <MudText Typo="Typo.body2">@_user.LastName</MudText>
                            </MudStack>
                        </MudListItem>
                        <MudListItem T="string" Icon="@Icons.Material.Filled.Email">
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Email</MudText>
                                <MudText Typo="Typo.body2">@_user.Email</MudText>
                            </MudStack>
                        </MudListItem>
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
}

@code {
    private UserDto? _user;
    private bool _error;

    /// <inheritdoc />
    protected override async Task OnInitializedAsync()
    {
        _user = await AuthApi.GetCurrentUser(CancellationToken.None);
        if (_user is null)
        {
            _error = true;
        }
    }
}
